<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Skale Prototype - Building Skale: Community Culture</title>
  <script defer src="https://cdn.tailwindcss.com"></script>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      width: 100%;
      background-color: white !important;
    }
    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
    }
    .main-content {
      display: flex;
      flex-direction: column;
      width: 100%;
      padding: 0;
    }
    @media (min-width: 768px) {
      .main-content { flex-direction: row; }
    }
    .left-column {
      width: 100%;
      padding-right: 0;
    }
    @media (min-width: 768px) {
      .left-column { flex: 0 0 70%; padding-right: 1rem; }
    }
    .right-column {
      width: 100%;
      padding-left: 0;
      margin-top: 1rem;
      /* MATCH breadcrumb top spacing exactly */
      padding-top: 0.75rem; /* same as breadcrumb vertical padding */
    }
    @media (min-width: 768px) {
      .right-column { flex: 0 0 30%; padding-left: 1rem; margin-top: 0; }
    }

    /* ==== Breadcrumb ==== */
    .breadcrumb {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 0;
      font-size: 0.9rem;
      color: #6b7280;
      flex-wrap: wrap;
    }
    .breadcrumb-item { display: flex; align-items: center; gap: 0.5rem; }
    .breadcrumb-link { color: #6b7280; text-decoration: none; transition: color 0.2s; }
    .breadcrumb-link:hover { color: #374151; }
    .breadcrumb-active { color: #A3B18A; font-weight: 500; }
    .breadcrumb-separator { color: #d1d5db; }

    /* ==== Header ==== */
    .group-header-container {
      background-color: white;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      margin-bottom: 1rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-top: 0.5rem;
    }
    @media (min-width: 768px) {
      .group-header-container { flex-direction: row; padding: 1.5rem; min-height: 250px; }
    }
    .group-content { flex: 1; display: flex; flex-direction: column; }
    .group-title { font-size: 1.5rem; font-weight: bold; color: #374151; margin-bottom: 0.25rem; }
    .group-subtitle { font-size: 1rem; color: #6b7280; margin-bottom: 0.5rem; }
    .overview-container { margin-bottom: 0.75rem; flex-grow: 1; }
    .group-overview { color: #374151; line-height: 1.6; overflow: hidden; transition: all 0.3s ease; }
    .group-overview.collapsed {
      display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; max-height: 4.8em;
    }
    .group-overview.expanded { display: block; max-height: none; }
    .read-more-btn { background: none; border: none; color: #A3B18A; font-size: 0.9rem; cursor: pointer; padding: 0.25rem 0; margin-top: 0.5rem; font-weight: 500; }
    .read-more-btn:hover { text-decoration: underline; }

    .moderator-info { display: flex; align-items: center; gap: 1rem; margin-top: auto; padding-top: 0.5rem; }
    .moderator-avatar {
      width: 2.5rem; height: 2.5rem; background-color: #A3B18A; border-radius: 50%;
      display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 0.9rem; flex-shrink: 0;
    }
    .moderator-details { font-size: 0.9rem; }
    .moderator-name { font-weight: 600; color: #374151; }
    .moderator-role { color: #6b7280; }

    .group-image {
      width: 100%; height: 200px; background-color: #A3B18A; border-radius: 8px; flex-shrink: 0;
    }
    @media (min-width: 768px) { .group-image { width: 25%; height: 200px; } }

    /* ==== Topics ==== */
    .topics-container { position: relative; }
    .topic-card {
      background-color: white;
      border: none !important;
      border-radius: 0 !important;
      box-shadow: none !important;
      margin-bottom: 0.75rem !important;
      padding: 0.5rem 0.25rem;
      border-bottom: 1px solid #e5e7eb !important;
    }
    .topic-card:last-child { border-bottom: none !important; }
    .topic-detail-container {
      background-color: white;
      border: none !important;
      border-radius: 0;
      box-shadow: none !important;
      padding: 0.75rem 0;
      margin-bottom: 0.75rem;
      border-bottom: 1px solid #e5e7eb !important;
    }
  </style>
</head>
<body class="font-sans min-h-screen">
  <div class="container">
    <div class="main-content">
      <div class="left-column">
        <!-- Breadcrumb -->
        <div class="breadcrumb">
          <div class="breadcrumb-item"><a href="/" class="breadcrumb-link">Home</a></div>
          <span class="breadcrumb-separator">/</span>
          <div class="breadcrumb-item"><a href="/discussions" class="breadcrumb-link">Discussions</a></div>
          <span class="breadcrumb-separator">/</span>
          <div class="breadcrumb-item"><a href="/group_building_skale" class="breadcrumb-link">Building Skale</a></div>
          <span class="breadcrumb-separator">/</span>
          <div class="breadcrumb-item"><span class="breadcrumb-active">Community Culture</span></div>
        </div>

        <!-- Header -->
        <div class="group-header-container" id="groupHeader">
          <div class="group-content">
            <h1 class="group-title">Community Culture</h1>
            <h2 class="group-subtitle">Fostering a Kind and Global Skale Environment</h2>
            <div class="overview-container">
              <div class="group-overview collapsed" id="overviewText">
                The Community Culture subgroup is where Skale members come together to
                nurture the values, kindness, and global spirit that define our platform.
                We discuss leadership, inclusion, respect, and collaboration — building
                a foundation that makes Skale a thriving, supportive community for everyone.
                Whether you’re mentoring, moderating, or contributing ideas, your voice
                helps shape the atmosphere that powers our collective growth.
              </div>
              <button class="read-more-btn" id="readMoreBtn">Read more...</button>
            </div>

            <div class="moderator-info">
              <div class="moderator-avatar">JH</div>
              <div class="moderator-details">
                <div class="moderator-name">James Harakaly</div>
                <div class="moderator-role">Community Director</div>
              </div>
            </div>
          </div>
          <div class="group-image"></div>
        </div>

        <!-- Topic Feed -->
        <h2 class="text-2xl font-semibold text-[#344E41] mb-6">Discussion Topics</h2>

        <div id="expanded-topics" class="topics-container">
          <div id="topic-detail-1" style="display: none;" class="topic-detail-container">
            <SkalePrototypeWeb.Components.TopicDetail.render topic={SkalePrototypeWeb.MockData.get_topic_replies()} topic_id={1} />
          </div>

          <%= for topic <- SkalePrototypeWeb.MockData.get_building_culture_topics() |> Enum.drop(1) do %>
            <div id={"topic-detail-#{topic.id}"} style="display: none;" class="topic-detail-container">
              <SkalePrototypeWeb.Components.TopicDetail.render topic={topic} topic_id={topic.id} />
            </div>
          <% end %>

          <%= for topic <- SkalePrototypeWeb.MockData.get_building_culture_topics() do %>
            <SkalePrototypeWeb.Components.TopicCards.topic_cards
              id={topic.id}
              title={topic.title}
              excerpt={topic.excerpt}
              content={topic.content}
              reply_count={topic.reply_count}
              time_ago={topic.time_ago}
              avatars={topic.avatars}
              additional_count={topic.additional_count}
              has_media={Map.get(topic, :media, nil) != nil && Map.get(topic, :media, []) != []}
              media_type={
                if Map.get(topic, :media, nil) != nil && Map.get(topic, :media, []) != [] do
                  topic.media |> List.first() |> Map.get(:type)
                end
              }
              media={Map.get(topic, :media, [])}
            />
          <% end %>
        </div>
      </div>

      <!-- Right Sidebar -->
      <SkalePrototypeWeb.Components.RightSidebar.right_sidebar />
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const overviewText = document.getElementById('overviewText');
      const readMoreBtn = document.getElementById('readMoreBtn');
      const groupHeader = document.getElementById('groupHeader');

      let isExpanded = false;
      readMoreBtn.addEventListener('click', function() {
        if (isExpanded) {
          overviewText.classList.remove('expanded');
          overviewText.classList.add('collapsed');
          readMoreBtn.textContent = 'Read more...';
          groupHeader.classList.remove('expanded');
        } else {
          overviewText.classList.remove('collapsed');
          overviewText.classList.add('expanded');
          readMoreBtn.textContent = 'Read less';
          groupHeader.classList.add('expanded');
        }
        isExpanded = !isExpanded;
      });
    });

    document.addEventListener("click", function(e) {
      if (e.target && e.target.closest(".view-replies-btn")) {
        const btn = e.target.closest(".view-replies-btn");
        const topicId = btn.getAttribute("phx-value-topic-id");
        const detail = document.getElementById(`topic-detail-${topicId}`);
        document.querySelectorAll(".topic-detail-container").forEach(d => d.style.display = "none");
        const card = document.getElementById(`topic-${topicId}`);
        if (card && detail) {
          detail.style.display = "block";
          card.insertAdjacentElement("afterend", detail);
          detail.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      }
      if (e.target && e.target.closest(".close-topic-btn")) {
        const btn = e.target.closest(".close-topic-btn");
        const topicId = btn.getAttribute("data-topic-id");
        const detail = document.getElementById(`topic-detail-${topicId}`);
        if (detail) detail.style.display = "none";
      }
    });
  </script>
</body>
</html>
