<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Skale Prototype - Beginner Vegan</title>
  <script defer src="https://cdn.tailwindcss.com"></script>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      width: 100%;
    }
    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
    }
    .main-content {
      display: flex;
      flex-direction: column;
      width: 100%;
      padding: 0;
    }
    @media (min-width: 768px) {
      .main-content {
        flex-direction: row;
      }
    }
    .left-column {
      width: 100%;
      padding-right: 0;
    }
    @media (min-width: 768px) {
      .left-column {
        flex: 0 0 70%;
        padding-right: 1rem;
      }
    }
    .right-column {
      width: 100%;
      padding-left: 0;
      margin-top: 2rem;
    }
    @media (min-width: 768px) {
      .right-column {
        flex: 0 0 30%;
        padding-left: 1rem;
        margin-top: 0;
      }
    }
    .search-container {
      position: relative;
      margin-bottom: 1.5rem;
      padding-top: 0.75rem;
    }
    .search-icon {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      font-size: 1.2rem;
      color: #6b7280;
    }
    .search-input {
      padding-left: 3rem;
      width: 100%;
      background-color: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
      font-size: 1rem;
    }
    @media (max-width: 480px) {
      .search-input {
        font-size: 16px;
      }
    }
    .breadcrumb {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 1rem 0;
      font-size: 0.9rem;
      color: #6b7280;
      flex-wrap: wrap;
    }
    @media (max-width: 480px) {
      .breadcrumb {
        font-size: 0.8rem;
        padding: 0.75rem 0;
      }
    }
    .breadcrumb-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .breadcrumb-link {
      color: #6b7280;
      text-decoration: none;
      transition: color 0.2s;
    }
    .breadcrumb-link:hover {
      color: #374151;
    }
    .breadcrumb-active {
      color: #A3B18A;
      font-weight: 500;
    }
    .breadcrumb-separator {
      color: #d1d5db;
    }
    .group-header-container {
      background-color: white;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      margin-bottom: 2rem;
      min-height: auto;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      position: relative;
      transition: min-height 0.3s ease;
      margin-top: 1rem;
    }
    @media (min-width: 768px) {
      .group-header-container {
        flex-direction: row;
        padding: 2rem;
        min-height: 300px;
      }
    }
    .group-header-container.expanded {
      min-height: auto;
    }
    @media (min-width: 768px) {
      .group-header-container.expanded {
        min-height: 400px;
      }
    }
    .group-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: auto;
    }
    @media (min-width: 768px) {
      .group-content {
        min-height: 256px;
      }
    }
    .group-title {
      font-size: 1.25rem;
      font-weight: bold;
      color: #374151;
      margin-bottom: 0.5rem;
    }
    @media (min-width: 768px) {
      .group-title {
        font-size: 1.5rem;
      }
    }
    .group-subtitle {
      font-size: 1rem;
      color: #6b7280;
      margin-bottom: 1rem;
    }
    @media (min-width: 768px) {
      .group-subtitle {
        font-size: 1.1rem;
      }
    }
    .overview-container {
      margin-bottom: 1.5rem;
      flex-grow: 1;
    }
    .group-overview {
      color: #374151;
      line-height: 1.6;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    .group-overview.collapsed {
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      max-height: 4.8em;
    }
    .group-overview.expanded {
      display: block;
      max-height: none;
    }
    .read-more-btn {
      background: none;
      border: none;
      color: #A3B18A;
      font-size: 0.9rem;
      cursor: pointer;
      padding: 0.25rem 0;
      margin-top: 0.5rem;
      font-weight: 500;
    }
    .read-more-btn:hover {
      text-decoration: underline;
    }
    .moderator-info {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-top: auto;
      padding-top: 1rem;
    }
    .moderator-avatar {
      width: 2.5rem;
      height: 2.5rem;
      background-color: #a3b18a;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 0.9rem;
      flex-shrink: 0;
    }
    @media (min-width: 768px) {
      .moderator-avatar {
        width: 3rem;
        height: 3rem;
        font-size: 1rem;
      }
    }
    .moderator-details {
      font-size: 0.9rem;
    }
    .moderator-name {
      font-weight: 600;
      color: #374151;
    }
    .moderator-role {
      color: #6b7280;
    }
    .group-image {
      width: 100%;
      height: 200px;
      background-color: #9ca3af;
      border-radius: 8px;
      flex-shrink: 0;
    }
    @media (min-width: 768px) {
      .group-image {
        width: 25%;
        height: 256px;
      }
    }
    .collection-container {
      aspect-ratio: 1 / 1;
      display: flex;
      flex-direction: column;
      background-color: white;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      margin-bottom: 1.5rem;
    }
    @media (max-width: 480px) {
      .collection-container {
        padding: 1rem;
        margin-bottom: 1rem;
      }
    }
    .collection-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    .gray-square {
      width: 100%;
      flex-grow: 1;
      background-color: #9ca3af;
      border-radius: 8px;
    }
  </style>
</head>
<body class="bg-gray-100 font-sans min-h-screen">
  <div class="container">
    <div class="main-content">
      <div class="left-column">
        <!-- Breadcrumb only in left column -->
        <div class="breadcrumb">
          <div class="breadcrumb-item">
            <a href="/" class="breadcrumb-link">Home</a>
          </div>
          <span class="breadcrumb-separator">/</span>
          <div class="breadcrumb-item">
            <a href="/discussions" class="breadcrumb-link">Discussions</a>
          </div>
          <span class="breadcrumb-separator">/</span>
          <div class="breadcrumb-item">
            <a href="/groups/vegan-cookbook" class="breadcrumb-link">Vegan Cookbook Club</a>
          </div>
          <span class="breadcrumb-separator">/</span>
          <div class="breadcrumb-item">
            <span class="breadcrumb-active">Beginner Vegan</span>
          </div>
        </div>
        <!-- Group Header Container -->
        <div class="group-header-container" id="groupHeader">
          <div class="group-content">
            <h1 class="group-title">Beginner Vegan</h1>
            <h2 class="group-subtitle">Your Starting Point for Plant-Based Living</h2>
            <div class="overview-container">
              <div class="group-overview collapsed" id="overviewText">
                Welcome to the Beginner Vegan subgroup! This is your starting point for transitioning to a plant-based lifestyle.
                Here you'll find support, recipes, tips, and answers to all your beginner questions. Whether you're just curious
                about veganism or fully committed to the lifestyle, this community is here to help you every step of the way.
                Share your journey, ask questions, and connect with others who are also exploring plant-based living.
              </div>
              <button class="read-more-btn" id="readMoreBtn">Read more...</button>
            </div>
            <div class="moderator-info">
              <div class="moderator-avatar">MJ</div>
              <div class="moderator-details">
                <div class="moderator-name">Michael Johnson</div>
                <div class="moderator-role">Subgroup Moderator</div>
              </div>
            </div>
          </div>
          <div class="group-image"></div>
        </div>

        <!-- Topics Container (replaces subgroups) -->
        <div class="topics-container">
          <!-- Expanded views -->
          <div id="topic-detail-1" style="display: none;">
            <.topic_detail topic={SkalePrototypeWeb.MockData.get_topic_replies()} />
          </div>
          <%= for topic <- SkalePrototypeWeb.MockData.get_all_topics() |> Enum.drop(1) do %>
            <div id={"topic-detail-#{topic.id}"} style="display: none;">
              <.topic_detail topic={topic} />
            </div>
          <% end %>
          <!-- Collapsed topic cards -->
          <%= for topic <- SkalePrototypeWeb.MockData.get_all_topics() do %>
            <.topic_card
              id={topic.id}
              title={topic.title}
              excerpt={topic.excerpt}
              reply_count={topic.reply_count}
              time_ago={topic.time_ago}
              avatars={topic.avatars}
              additional_count={topic.additional_count}
            />
          <% end %>
        </div>
      </div>

      <div class="right-column">
        <!-- Search bar moved to right column -->
        <div class="search-container">
          <span class="search-icon">Search</span>
          <input type="text" placeholder="Search..." class="p-2 rounded text-base search-input">
        </div>
        <div class="space-y-4">
          <div class="collection-container">
            <div class="collection-header">
              <h2 class="text-black text-base font-semibold">My Collection</h2>
              <a href="#" class="text-[#A3B18A] text-sm">See All</a>
            </div>
            <div class="gray-square"></div>
            <div class="text-left mt-2">
              <p class="text-black text-sm">Title</p>
              <p class="text-black text-xs">Subtitle</p>
            </div>
          </div>
          <div class="collection-container">
            <div class="collection-header">
              <h2 class="text-black text-base font-semibold">Events</h2>
              <a href="#" class="text-[#A3B18A] text-sm">See All</a>
            </div>
            <div class="gray-square"></div>
            <div class="text-left mt-2">
              <p class="text-black text-xs">Date</p>
              <p class="text-black text-xs">Title</p>
            </div>
          </div>
          <div class="collection-container">
            <div class="collection-header">
              <h2 class="text-black text-base font-semibold">Featured</h2>
              <a href="#" class="text-[#A3B18A] text-sm">See All</a>
            </div>
            <div class="gray-square"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const overviewText = document.getElementById('overviewText');
      const readMoreBtn = document.getElementById('readMoreBtn');
      const groupHeader = document.getElementById('groupHeader');
     
      let isExpanded = false;
      readMoreBtn.addEventListener('click', function() {
        if (isExpanded) {
          overviewText.classList.remove('expanded');
          overviewText.classList.add('collapsed');
          readMoreBtn.textContent = 'Read more...';
          groupHeader.classList.remove('expanded');
        } else {
          overviewText.classList.remove('collapsed');
          overviewText.classList.add('expanded');
          readMoreBtn.textContent = 'Read less';
          groupHeader.classList.add('expanded');
        }
        isExpanded = !isExpanded;
      });
    });

    // Reply functionality
    let activeReplyId = null;
    window.toggleReplies = function(replyId) {
      const container = document.getElementById(`nested-replies-${replyId}`);
      const btn = document.querySelector(`button.expand-btn[data-reply-id="${replyId}"]`);
      if (container && btn) {
        container.classList.toggle('hidden');
        const svg = btn.querySelector('svg');
        const textSpan = btn.querySelector('.show-text');
        const count = btn.getAttribute('data-count');
        if (container.classList.contains('hidden')) {
          svg.style.transform = 'rotate(0deg)';
          textSpan.textContent = `Show ${count}`;
        } else {
          svg.style.transform = 'rotate(180deg)';
          textSpan.textContent = `Hide ${count}`;
        }
      }
    };
    window.showReplyForm = function(replyId) {
      hideAllReplyForms();
      activeReplyId = replyId;
      const form = document.getElementById(`reply-form-${replyId}`);
      if (form) form.classList.remove('hidden');
    };
    function hideAllReplyForms() {
      document.querySelectorAll('[id^="reply-form-"]').forEach(form => {
        form.classList.add('hidden');
      });
      activeReplyId = null;
    }
    window.cancelReply = function(replyId) {
      const form = document.getElementById(`reply-form-${replyId}`);
      if (form) form.classList.add('hidden');
      activeReplyId = null;
    };
    window.submitReply = function(replyId) {
      const textarea = document.querySelector(`#reply-form-${replyId} textarea`);
      if (textarea && textarea.value.trim()) {
        alert(`Reply submitted: ${textarea.value}`);
        textarea.value = '';
        cancelReply(replyId);
      }
    };

    // FIXED: View Replies Button
    document.addEventListener('click', function (e) {
      const viewRepliesBtn = e.target.closest('.view-replies-btn');
      if (viewRepliesBtn) {
        const topicId = viewRepliesBtn.getAttribute('phx-value-topic-id');
        const topicDetail = document.getElementById(`topic-detail-${topicId}`);
        if (topicDetail) {
          document.querySelectorAll('[id^="topic-detail-"]').forEach(d => d.id !== `topic-detail-${topicId}` && (d.style.display = 'none'));
          document.querySelectorAll('.topic-card').forEach(c => c.style.display = 'none');
          topicDetail.style.display = 'block';
          topicDetail.querySelectorAll('[id^="nested-replies-"]').forEach(el => el.classList.add('hidden'));
          topicDetail.querySelectorAll('.expand-btn').forEach(btn => {
            const svg = btn.querySelector('svg');
            const textSpan = btn.querySelector('.show-text');
            svg.style.transform = 'rotate(0deg)';
            textSpan.textContent = `Show ${btn.getAttribute('data-count')}`;
          });
          hideAllReplyForms();
        }
      }
    });
  </script>
</body>
</html>